<h1>Список запросов</h1>

<table class="zebra-striped bordered-table">
  <tr>
    <th>Авто</th>
    <th>Статус</th>
    <th>Предпросмотр</th>
    <th></th>
  </tr>

<% @requests.each do |request| %>
  <tr>
    <% # избавиться от N+1 TODO %>
    <td><%= car_identity(request) if request.car.present? %></td>
    <% if request.messages.last.user == current_user %>
      <td><p class='icons icons-sprite icons-message-dirty-light' style="left: 43%; display: block; position: relative"></p></td>
    <% else %>
      <td><p class='icons icons-sprite icons-message-dirty-dark' style="left: 43%; display: block; position: relative"></p></td>
    <% end %>
    <td><%= truncate(request.messages.last.message, :length => 320) %></td>
    <td>
      <%= link_to "<div href='#' class='btn primary' style='margin-bottom: 7px'>Перейти&nbsp;к&nbsp;диалогу</div>".html_safe, request_path(request, :anchor => "reply") %>
      <%= link_to "<p class='icons icons-sprite icons-delete'>Удалить&nbsp;запрос</p>".html_safe, request, :confirm => 'Вы действительно хотите удалить запрос? Весь диалог, связанный с ним будет удален.', :method => :delete %>
    </td>
  </tr>
<% end %>
</table>

<br />

<%= link_to 'Создать новый запрос', cars_path, :class => "btn primary" %>
