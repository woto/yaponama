<% status = item_status(params[:catalog_number], params[:manufacturer]) %>

<% content_for(:pages_controller) do %>
  <% path = CGI::unescape(request.fullpath).gsub(/^\/+/, '') %>
  <% if (page = Page.where(:path => path).first).present? %>
    <li><%= link_to "Редактировать", edit_page_path(page) %> </li>
  <% else %>
    <li><%= link_to "Создать", new_predefined_page_path(CGI::escape(CGI::escape(path))) %> </li>
  <% end %>
<% end %>

<% case status[:their]  %>
  <% when 'avaliable' %>
    <div id='info' class='static'><%= @static.html_safe %></div>
  <% when 'unknown' %>
    <script>
      <% catalog_number = params[:catalog_number] %>
      <% manufacturer = params[:manufacturer] %>
      $(document).ready(function(){
        Application.connect();
        Application.publish('info', "<%= catalog_number %>", "<%= manufacturer %>");
      });
    </script>
    <div id='info' class='dynamic'></div>
<% end %>

<%= raw @page.default_content if @page %>
