<style>
  .container-fluid > .content {
    margin: 0;
  }
</style>

<h1>Поиск запчастей</h1>

<%= form_tag(searches_path(:anchor => "jump"), :method => :get) do %>
  <div class="inputs">

    <div class="clearfix string optional">
      <label class="string optional">
        Каталожный номер
      </label>
      <div class="input">
        <%= text_field_tag :catalog_number, params[:catalog_number] %> <br />
      </div>
    </div>
    

    <div class="clearfix string optional">
      <label class="string optional">
        Производитель
      </label>
      <div class="input">
        <%= text_field_tag :manufacturer, params[:manufacturer] %> <br />
      </div>
    </div>


    <div class="clearfix string optional">
      <label class="string optional">
        Замены и аналоги
      </label>
      <div class="input" style="margin-top: 6px">
        <%= check_box_tag :replacements, "1", params[:replacements] %> <br />
      </div>
    </div>

    <div class="actions">

      <%= submit_tag "Искать", :class => "primary btn" %>&nbsp;&nbsp;
      <% if user_search_histories.limit(3).size > 0 %>
        <% user_search_histories.limit(3).each do |ush| %>
          <%= link_to(ush.catalog_number + (ush.manufacturer? ?  " - " + ush.manufacturer : ""), search_searches_path(ush.catalog_number, ush.manufacturer)) + ", " %>
        <% end %>
        <%= link_to "вся история поиска...", search_histories_path %>
      <% end %>
    </div>
  </div>
<% end %>

<% if @parsed_json["result_prices"].count > 0 %>
  <br />

  <p id="jump"><span class="label notice">Подсказка</span> Используйте сортировку по нескольким полям зажав клавишу Shift и щелкая мышью по заголовку таблицы. Например нажмите на заголовке Производитель, зажмите Shift и щелкните по заголовку Цена.</p>

  <br />

  <table id="result-prices" class="bordered-table zebra-striped">
    <thead>
      <tr>
        <th style="width: 80px">  Произв. </th>
        <th style="width: 80px"> Кат.&nbsp;ном. </th>
        <th> Название </th>
        <th style="width: 60px">  Нал. </th>
        <th style="width: 50px">  От </th>
        <th style="width: 50px">  До  </th>
        <th style="width: 50px">  Расп.  </th>
        <th style="width: 50px">  Цена </th>
      </tr>
    </thead>
    <tbody>
      <% @parsed_json["result_prices"].each do |result_price| %>
        <tr>
          <td> <%= manufacturer = result_price["manufacturer"] %> </td>
          <td> <%= catalog_number = result_price["catalog_number"] %> </td>
          <td> <%= title = (("#{result_price["title"].to_s} #{result_price["title_en"].to_s}").mb_chars.gsub(/([^ ]{25})/, '\1 ')) %> </td>
          <td> <%= count = ((count = (result_price["count"].to_s.gsub(/\D/, '').to_i)) > 1) ? count : '*' %> шт.</td>
          <td> <%= declared = (( declared = (result_price["job_import_job_delivery_days_declared"].to_i)) > 0) ? declared : '*' %> дн.</td>
          <td> <%= average = (( average = (result_price["job_import_job_delivery_days_average"].to_i)) > 0) ? average : '*'  %> дн.</td>
          <td> <%= country = result_price["job_import_job_country_short"] %> </td>
          <td>
            <span style="visibility: hidden; display:none"><%= income_cost = (result_price["income_cost"] * 1.07).to_i.to_s %></span>
            <%= form_for(:wish, :remote => true, :format => :json, :url => wishes_path, :method => :post, :html => {:style=>"margin: 0"}) do |f| %>
              <%= f.hidden_field :cost, :value => income_cost %>
              <%= f.hidden_field :catalog_number, :value => catalog_number %>
              <%= f.hidden_field :manufacturer, :value => manufacturer %>
              <%= f.hidden_field :title, :value => title %>
              <%= f.hidden_field :count, :value => count %>
              <%= f.hidden_field :declared, :value => declared %>
              <%= f.hidden_field :average, :value => average %>
              <%= f.hidden_field :country, :value => country %>
              <%= f.submit "#{income_cost} руб.", :class => "btn primary", :style=>"width: 90px" %>
            <% end %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>

  <div id="pager" class="pager" style="color: red">
    ДОРАБОТАТЬ TODO!

    <form>
      <span class="first"/>Первая</span>
      <span class="prev">Предыдущая</span>
      <input type="text" class="pagedisplay"/>
      <span class="next"/>Вперед</span>
      <span class="last">Последняя</span>
      <select class="pagesize">
        <option selected="selected"  value="10">10</option>
        <option value="20">20</option>
        <option value="30">30</option>
        <option  value="40">40</option>
      </select>
    </form>
  </div>
<br />
<br />
<br />
<br />
<br />
<% end %>

